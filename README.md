# Stock Miner

![Trade Executor](https://i.ibb.co/mDpFwsy/image.png)

## Установка

Для установки необходимо выполнить следующие шаги:

### 1. Создать базу mongodb с названием tin

### 2. Заполнить настройки в файле settings.py

Нужно проставить свои токены от TINKOFF и от TELEGRAM Bot API в переменные окружения
Еще понадобится ваш айди в телеграме.

```bash 
export TINKOFF_TOKEN='MY TOKEN'
export TINKOFF_TG_BOT_TOKEN='MY TOKEN'
export TINKIFF_ROOT_TG_ID='MY ID'
```

### 3. Установить все необходимые зависимости с помощью pip:

```bash
pip install -r requirements.txt
```

## Запуск

Чтобы запустить приложение, выполните следующую команду:

```bash
python main.py
```

# Доступ к интерфейсу

После запуска, приложение будет доступно по адресу localhost:8080.

# Как это работает?

Когда клиентская часть получает котировки через сокет в режиме реального времени, она начинает анализировать их, используя основные статистические функции. Каждой из этих функций присваивается определенный вес, который отражает их важность при принятии решения о том, будет ли расти актив.

Затем веса суммируются для каждого инструмента, и на их основе рассчитывается процентная вероятность того, что цена актива увеличится. Эти данные отправляются на сервер и сохраняются в базе данных MongoDB.

На сервере данные о курсах и прогнозы хранятся в базе, что позволяет бэкенду проверять точность прогнозов, сделанных клиентской частью. Бэкенд проверяет, насколько точными были прогнозы, и отправляет обратно на клиент процентное соотношение верных прогнозов. Чем ближе процент к 100, тем лучше прогнозирование, и тем зеленее отображается цвет инструмента на клиенте; чем ниже процент, тем краснее.

Далее бэкэнд рассчитывает экспоненциальное скользящее среднее (EMA), простое скользящее среднее (SMA) и индекс относительной силы (RSI) для данных из базы данных с другими периодами и большим диапазоном, чем на клиенте. На основе этих расчетов принимается решение о формировании финального прогноза, который может быть отправлен брокеру для создания поручения.

Принятие решения также зависит от уровней стоп-лосса (SL) и тейк-профита (TP), которые устанавливаются на клиенте, но могут быть скорректированы на основе расчетов средней истинной диапазонности (ATR).

Когда клиентская часть получает котировки через сокет в режиме реального времени, она начинает анализировать их, используя основные статистические функции. Каждой из этих функций присваивается определенный вес, который отражает их важность при принятии решения о том, будет ли расти актив.

Затем веса суммируются для каждого инструмента, и на их основе рассчитывается процентная вероятность того, что цена актива увеличится. Эти данные отправляются на сервер и сохраняются в базе данных MongoDB.

На сервере данные о курсах и прогнозы хранятся в базе, что позволяет бэкенду проверять точность прогнозов, сделанных клиентской частью. Бэкенд проверяет, насколько точными были прогнозы, и отправляет обратно на клиент процентное соотношение верных прогнозов. Чем ближе процент к 100, тем лучше прогнозирование, и тем зеленее отображается цвет инструмента на клиенте; чем ниже процент, тем краснее.

Далее бэкэнд рассчитывает экспоненциальное скользящее среднее (EMA), простое скользящее среднее (SMA) и индекс относительной силы (RSI) для данных из базы данных с другими периодами и большим диапазоном, чем на клиенте. На основе этих расчетов принимается решение о формировании финального прогноза, который может быть отправлен брокеру для создания поручения.

Принятие решения также зависит от уровней стоп-лосса (SL) и тейк-профита (TP), которые устанавливаются на клиенте, но могут быть скорректированы на основе расчетов средней истинной диапазонности (ATR).

# Какие настройки доступны?

Для настройки доступны следующие параметры:

- Stop Loss - порог процента потери
- Take Profit - порог процента выручки
- SMA период - размер периода для рассчета SMA на клиенте
- EMA период - размер периода для рассчета EMA на клиенте
- WMA период - размер периода для рассчета WMA на клиенте
- RSI окно - размер окна для рассчета RSI на клиенте
- Market data interval - таймер для отправки прогнозов на сервер
- Minutes to store - количество минут, за которое будут храниться котировки на клиенте в IndexDB
- Reverse mode - обратный режим (покупать при прогнозе продажи)

# Стратегии Технического Анализа

## SMA (скользящее среднее арифметическое)

    Краткосрочные стратегии: 5-20 периодов
    Среднесрочные стратегии: 20-50 периодов

## EMA (экспоненциальное скользящее среднее)

    Краткосрочные стратегии: 5-20 периодов
    Среднесрочные стратегии: 20-50 периодов

## WMA (взвешенное скользящее среднее)

    Краткосрочные стратегии: 5-20 периодов
    Среднесрочные стратегии: 20-50 периодов

## RSI (индекс относительной силы)

    Общепринятый диапазон: 14 периодов (стандарт)
    Краткосрочные стратегии: 5-10 периодов
    Долгосрочные стратегии: 20-30 периодов

# Как работает стратегия

Стратегия использует технический анализ для принятия решений о покупке или продаже активов.

    SMA, EMA, WMA: Скользящие средние используются для определения общего направления тренда. Когда цена актива пересекает скользящую среднюю вверх, это может сигнализировать о покупке, а когда цена пересекает среднюю вниз, это может сигнализировать о продаже.

    RSI: Индекс относительной силы используется для определения перекупленности или перепроданности актива. Значения RSI ниже 30 указывают на перепроданность и возможное возрастание цены, а значения выше 70 указывают на перекупленность и возможное снижение цены.

Стратегия также учитывает вероятность прогноза и другие параметры, чтобы принимать решения о покупке, продаже или удержании активов.

Настройки, такие как частота отправки данных на сервер и время хранения данных на клиенте, позволяют настраивать поведение бота без перезапуска.

После принятия решения сервер отправляет оповещения в Telegram о важных событиях в стратегии.